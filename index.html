<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TeenBank — Single‑File React (Enhanced)</title>

  <!-- Tailwind (CDN) -->
  <script>
    window.tailwind = { config: { darkMode: 'class' } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 (production UMD) + Babel for JSX in-browser -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="h-full bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100">
  <div id="root" class="h-full"></div>

  <script type="text/babel">
    // TeenBank — single-file React app (frontend-only)
    // Improvements over your original:
    // - Fixed React hooks misuse (no hooks inside loops) via GoalRow component.
    // - Added Transactions ledger (computed balance) with Undo.
    // - Import/Export data (JSON), data schema version & migration.
    // - Search in Admin, user switcher, dark mode toggle (persisted).
    // - Safer number parsing, accessibility labels, toasts.

    const { useEffect, useMemo, useState, useRef } = React;

    // --- Constants & helpers -------------------------------------------------
    const ADMIN_EMAIL = 'hasslerw748@stu.mw.k12.ny.us';
    const DB_KEY = 'teenbank_participants_v2';
    const THEME_KEY = 'teenbank_theme';

    const DEFAULT_PARTICIPANTS = [
      { id: 1, name: 'Ava',  email: 'ava@gmail.com',  subscriptionActive: false, weeklyDeductions: [], goals: [], budgets: {}, transactions: [{amount: 50, memo: 'Starting balance', ts: Date.now()-3_600_000}] },
      { id: 2, name: 'Ben',  email: 'ben@gmail.com',  subscriptionActive: true,  weeklyDeductions: [], goals: [], budgets: {}, transactions: [{amount: 75, memo: 'Starting balance', ts: Date.now()-2_600_000}] },
      { id: 3, name: 'Maya', email: 'maya@gmail.com', subscriptionActive: false, weeklyDeductions: [], goals: [], budgets: {}, transactions: [{amount: 30, memo: 'Starting balance', ts: Date.now()-1_600_000}] },
    ];

    function fmtUSD(n){ return (Number(n)||0).toLocaleString(undefined,{style:'currency',currency:'USD'}); }
    function now(){ return Date.now(); }

    function computeBalance(user){
      const tx = user.transactions || [];
      return tx.reduce((s,t)=> s + Number(t.amount||0), 0);
    }

    function migrateIfNeeded(raw){
      // v1 -> v2 migration: move balance -> transactions if transactions missing
      const list = raw ? JSON.parse(raw) : DEFAULT_PARTICIPANTS;
      return list.map(u => {
        const copy = {...u};
        if (!Array.isArray(copy.transactions)) copy.transactions = [];
        // If old "balance" exists and no transactions yet, seed one
        if (typeof copy.balance === 'number' && copy.transactions.length === 0){
          if (copy.balance !== 0) copy.transactions.push({ amount: copy.balance, memo: 'Imported starting balance', ts: now()-5000 });
          delete copy.balance;
        }
        return copy;
      });
    }

    function loadParticipants(){
      try {
        const stored = localStorage.getItem(DB_KEY);
        return migrateIfNeeded(stored);
      } catch (e){ console.warn('Load fail, using defaults', e); return DEFAULT_PARTICIPANTS; }
    }

    function saveParticipants(list){
      localStorage.setItem(DB_KEY, JSON.stringify(list));
    }

    // --- UI primitives -------------------------------------------------------
    function Toast({ text, onClose }){
      useEffect(() => { const t = setTimeout(onClose, 1800); return () => clearTimeout(t); }, [onClose]);
      return (
        <div className="fixed bottom-4 left-1/2 -translate-x-1/2 bg-black/90 text-white text-sm px-3 py-2 rounded shadow-lg">
          {text}
        </div>
      );
    }

    function ProgressBar({ value, max }){
      const pct = max > 0 ? Math.min(100, Math.round((value / max) * 100)) : 0;
      return (
        <div className="w-full h-2 bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden" role="progressbar" aria-valuenow={pct} aria-valuemin="0" aria-valuemax="100">
          <div className="h-2 bg-indigo-600" style={{ width: pct + '%' }} />
        </div>
      );
    }

    // Reusable subcomponent to avoid hooks-in-loop
    function GoalRow({ g, onContribute }){
      const [contrib, setContrib] = useState('');
      const saved = Number(g.saved)||0; const target = Number(g.target)||0; const remaining = Math.max(0, target - saved);
      return (
        <div className="p-3 rounded border border-slate-200 dark:border-slate-700">
          <div className="flex items-center justify-between gap-2">
            <div>
              <div className="font-medium">{g.name}</div>
              <div className="text-sm text-slate-600 dark:text-slate-300">{fmtUSD(saved)} / {fmtUSD(target)} <span className="text-slate-500">({fmtUSD(remaining)} left)</span></div>
            </div>
            <div className="flex items-center gap-2">
              <input className="border p-1 rounded w-28 dark:bg-slate-800 dark:border-slate-700" type="number" step="0.01" placeholder="$ add" value={contrib} onChange={e=>setContrib(e.target.value)} />
              <button className="bg-emerald-600 text-white px-3 py-1 rounded" onClick={()=>{ const n = parseFloat(contrib); if(!Number.isNaN(n) && n>0){ onContribute(n); setContrib(''); } }}>Contribute</button>
            </div>
          </div>
          <div className="mt-2"><ProgressBar value={saved} max={target} /></div>
        </div>
      );
    }

    // --- Admin ---------------------------------------------------------------
    function AdminPanel({ participants, onAdjust, onSubscribe, onCancel, onDelete }){
      const [q,setQ] = useState('');
      const filtered = useMemo(()=>{
        const t = q.trim().toLowerCase(); if(!t) return participants;
        return participants.filter(p => (p.name+' '+p.email).toLowerCase().includes(t));
      }, [participants, q]);

      return (
        <section className="md:col-span-2 bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-semibold">Admin · Participants</h3>
            <input className="border rounded px-2 py-1 text-sm dark:bg-slate-900 dark:border-slate-700" placeholder="Search name or email" value={q} onChange={e=>setQ(e.target.value)} />
          </div>
          <ul className="divide-y dark:divide-slate-700">
            {filtered.map(p => (
              <li key={p.id} className="py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div className="space-y-1">
                  <div className="font-medium">{p.name} <span className="text-slate-500">({p.email})</span></div>
                  <div className="text-sm text-slate-600 dark:text-slate-300">Balance: <strong>{fmtUSD(computeBalance(p))}</strong></div>
                  <div className="text-xs text-slate-500">Subscription: {p.subscriptionActive ? 'Active' : 'Inactive'}</div>
                </div>
                <div className="flex flex-wrap gap-2">
                  <button className="px-3 py-1 rounded bg-indigo-600 text-white text-xs" onClick={()=>onSubscribe(p.id)}>Activate</button>
                  <button className="px-3 py-1 rounded bg-rose-600 text-white text-xs" onClick={()=>onCancel(p.id)}>Cancel</button>
                  <button className="px-3 py-1 rounded bg-emerald-600 text-white text-xs" onClick={()=>onAdjust(p.id, +5, 'Admin +$5')}>+ $5</button>
                  <button className="px-3 py-1 rounded bg-amber-600 text-white text-xs" onClick={()=>onAdjust(p.id, -5, 'Admin -$5')}>− $5</button>
                  <button className="px-3 py-1 rounded bg-slate-800 text-white text-xs" onClick={()=>onDelete(p.id)}>Delete</button>
                </div>
              </li>
            ))}
          </ul>
          <p className="mt-3 text-sm text-slate-500">Admin can control access, write adjustments as transactions, and manage subscriptions.</p>
        </section>
      );
    }

    // --- User ---------------------------------------------------------------
    function UserPanel({ user, updateUser, applyWeeklyAll }){
      const [delta, setDelta] = useState('');
      const [memo, setMemo] = useState('');
      const [wdName, setWdName] = useState('');
      const [wdAmt, setWdAmt] = useState('');
      const [goalName, setGoalName] = useState('');
      const [goalTarget, setGoalTarget] = useState('');
      const [cat, setCat] = useState('');
      const [bAmt, setBAmt] = useState('');

      const balance = useMemo(()=> computeBalance(user), [user.transactions]);

      function pushTx(amount, memo){
        updateUser(u => ({...u, transactions: [...(u.transactions||[]), { amount: Number(amount), memo: memo||null, ts: now() }]}));
      }

      function deposit(){
        const n = parseFloat(delta); if(Number.isNaN(n) || n <= 0) return;
        // allocate to goals automatically first
        let remaining = n;
        const updGoals = (user.goals||[]).map(g => {
          if (remaining <= 0) return g;
          const need = Math.max(0, Number(g.target) - Number(g.saved));
          const add = Math.min(need, remaining);
          remaining -= add; return {...g, saved: Number(g.saved)+add};
        });
        updateUser(u => ({...u, goals: updGoals}));
        pushTx(n, memo || 'Deposit');
        setDelta(''); setMemo('');
      }

      function withdraw(){
        const n = parseFloat(delta); if(Number.isNaN(n) || n <= 0) return;
        pushTx(-n, memo || 'Withdraw');
        setDelta(''); setMemo('');
      }

      function undoLast(){
        updateUser(u => ({...u, transactions: (u.transactions||[]).slice(0, -1)}));
      }

      function addWeekly(){
        const n = parseFloat(wdAmt); if(!wdName || Number.isNaN(n) || n<=0) return;
        updateUser(u => ({...u, weeklyDeductions: [...(u.weeklyDeductions||[]), { name: wdName, amount: n }]}));
        // immediately apply once, like your original
        pushTx(-n, `Weekly: ${wdName}`);
        setWdName(''); setWdAmt('');
      }

      function removeWeekly(idx){
        updateUser(u => { const arr = [...(u.weeklyDeductions||[])]; arr.splice(idx,1); return {...u, weeklyDeductions: arr}; });
      }

      function addGoal(){
        const t = parseFloat(goalTarget); if(!goalName || Number.isNaN(t) || t<=0) return;
        updateUser(u => ({...u, goals: [...(u.goals||[]), { name: goalName, target: t, saved: 0 }]}));
        setGoalName(''); setGoalTarget('');
      }

      function contributeGoal(idx, amt){
        const n = Number(amt); if(Number.isNaN(n) || n<=0) return;
        updateUser(u => {
          const goals = [...(u.goals||[])];
          const g = {...goals[idx]};
          const maxAdd = Math.min(n, Math.max(0, Number(g.target) - Number(g.saved)));
          if (maxAdd <= 0) return u;
          g.saved = Number(g.saved) + maxAdd; goals[idx] = g;
          return {...u, goals};
        });
        pushTx(-n, 'Goal contribution');
      }

      function upsertBudget(){
        const n = parseFloat(bAmt); if(!cat || Number.isNaN(n) || n<=0) return;
        updateUser(u => ({...u, budgets: { ...(u.budgets||{}), [cat]: n }}));
        setCat(''); setBAmt('');
      }

      function deleteBudget(k){
        updateUser(u => { const b = { ...(u.budgets||{}) }; delete b[k]; return {...u, budgets: b}; });
      }

      return (
        <section className="md:col-span-2 bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm space-y-6">
          <div>
            <h3 className="text-lg font-semibold">Welcome, {user.name}</h3>
            <p className="text-sm text-slate-600 dark:text-slate-300">Balance: <strong>{fmtUSD(balance)}</strong></p>
          </div>

          {/* Transactions */}
          <div className="space-y-2">
            <h4 className="font-medium">Transactions</h4>
            <div className="flex flex-wrap gap-2 items-center">
              <input type="number" step="0.01" placeholder="$ amount" className="border p-2 rounded w-36 dark:bg-slate-900 dark:border-slate-700" value={delta} onChange={e=>setDelta(e.target.value)} />
              <input type="text" placeholder="Memo (optional)" className="border p-2 rounded w-60 dark:bg-slate-900 dark:border-slate-700" value={memo} onChange={e=>setMemo(e.target.value)} />
              <button className="bg-emerald-600 text-white px-3 py-2 rounded" onClick={deposit}>Deposit</button>
              <button className="bg-amber-600 text-white px-3 py-2 rounded" onClick={withdraw}>Withdraw</button>
              <button className="bg-slate-300 dark:bg-slate-700 text-slate-800 dark:text-slate-200 px-3 py-2 rounded" onClick={undoLast}>Undo last</button>
            </div>
            <ul className="divide-y dark:divide-slate-700 bg-slate-50 dark:bg-slate-900 rounded">
              {(user.transactions||[]).slice().reverse().map((t,i)=> (
                <li key={i} className="flex items-center justify-between p-2">
                  <span className="text-sm">{new Date(t.ts||now()).toLocaleString()} — {t.memo || '—'}</span>
                  <span className={"text-sm font-medium "+(t.amount>=0?'text-emerald-700':'text-rose-400')}>{t.amount>=0?'+':''}{Number(t.amount).toFixed(2)}</span>
                </li>
              ))}
              {(user.transactions||[]).length === 0 && <li className="p-2 text-sm text-slate-500">No transactions yet.</li>}
            </ul>
          </div>

          {/* Weekly deductions */}
          <div>
            <h4 className="font-medium mb-2">Weekly Deductions</h4>
            <div className="flex flex-wrap gap-2 mb-3">
              <input className="border p-2 rounded dark:bg-slate-900 dark:border-slate-700" placeholder="Name (e.g., Phone)" value={wdName} onChange={e=>setWdName(e.target.value)} />
              <input className="border p-2 rounded w-32 dark:bg-slate-900 dark:border-slate-700" type="number" step="0.01" placeholder="Amount" value={wdAmt} onChange={e=>setWdAmt(e.target.value)} />
              <button className="bg-indigo-600 text-white px-3 py-2 rounded" onClick={addWeekly}>Add & Apply</button>
              <button className="bg-slate-800 text-white px-3 py-2 rounded" onClick={applyWeeklyAll}>Run all weekly now</button>
            </div>
            <ul className="space-y-2">
              {(user.weeklyDeductions||[]).map((d,i)=> (
                <li key={i} className="flex items-center justify-between bg-slate-100 dark:bg-slate-900 p-2 rounded">
                  <span>{d.name} — <strong>{fmtUSD(d.amount)}</strong></span>
                  <button className="text-xs px-2 py-1 rounded bg-rose-600 text-white" onClick={()=>removeWeekly(i)}>Remove</button>
                </li>
              ))}
              {(!user.weeklyDeductions || user.weeklyDeductions.length===0) && (
                <li className="text-sm text-slate-500">No weekly deductions yet.</li>
              )}
            </ul>
          </div>

          {/* Goals */}
          <div>
            <h4 className="font-medium mb-2">Goals</h4>
            <div className="flex flex-wrap gap-2 mb-3">
              <input className="border p-2 rounded dark:bg-slate-900 dark:border-slate-700" placeholder="Goal name (e.g., Bike)" value={goalName} onChange={e=>setGoalName(e.target.value)} />
              <input className="border p-2 rounded w-32 dark:bg-slate-900 dark:border-slate-700" type="number" step="0.01" placeholder="Target $" value={goalTarget} onChange={e=>setGoalTarget(e.target.value)} />
              <button className="bg-indigo-600 text-white px-3 py-2 rounded" onClick={addGoal}>Add Goal</button>
            </div>
            <div className="space-y-3">
              {(user.goals||[]).map((g, idx) => (
                <GoalRow key={idx} g={g} onContribute={(amt)=>contributeGoal(idx, amt)} />
              ))}
              {(!user.goals || user.goals.length===0) && (
                <div className="text-sm text-slate-500">No goals yet. Add your first goal above.</div>
              )}
            </div>
          </div>

          {/* Budgets */}
          <div>
            <h4 className="font-medium mb-2">Budgets</h4>
            <div className="flex flex-wrap gap-2 mb-3">
              <input className="border p-2 rounded dark:bg-slate-900 dark:border-slate-700" placeholder="Category (e.g., Food)" value={cat} onChange={e=>setCat(e.target.value)} />
              <input className="border p-2 rounded w-32 dark:bg-slate-900 dark:border-slate-700" type="number" step="0.01" placeholder="Amount $" value={bAmt} onChange={e=>setBAmt(e.target.value)} />
              <button className="bg-indigo-600 text-white px-3 py-2 rounded" onClick={upsertBudget}>Add/Update</button>
            </div>
            <ul className="space-y-2">
              {Object.entries(user.budgets||{}).map(([k,v]) => (
                <li key={k} className="flex items-center justify-between bg-slate-100 dark:bg-slate-900 p-2 rounded">
                  <span className="font-medium">{k}</span>
                  <div className="flex items-center gap-3">
                    <span>{fmtUSD(v)}</span>
                    <button className="text-xs px-2 py-1 rounded bg-slate-300 dark:bg-slate-700" onClick={()=>deleteBudget(k)}>Delete</button>
                  </div>
                </li>
              ))}
              {Object.keys(user.budgets||{}).length===0 && (
                <li className="text-sm text-slate-500">No budgets yet.</li>
              )}
            </ul>
          </div>
        </section>
      );
    }

    // --- App ----------------------------------------------------------------
    function App(){
      const [participants, setParticipants] = useState(loadParticipants);
      const [currentEmail, setCurrentEmail] = useState('');
      const [password, setPassword] = useState('');
      const [toast, setToast] = useState(null);
      const [theme, setTheme] = useState(localStorage.getItem(THEME_KEY) || 'light');

      useEffect(()=>{ saveParticipants(participants); }, [participants]);
      useEffect(()=>{
        document.documentElement.classList.toggle('dark', theme==='dark');
        localStorage.setItem(THEME_KEY, theme);
      }, [theme]);

      const currentUser = useMemo(()=> participants.find(p => p.email.toLowerCase() === currentEmail.toLowerCase()) || null, [participants, currentEmail]);
      const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;

      function notify(msg){ setToast(msg); }

      function login(email, pw){
        const e = (email||'').trim().toLowerCase(); if(!e.includes('@')) return notify('Enter a valid email');
        let user = participants.find(u => u.email.toLowerCase() === e);
        if (!user){
          user = { id: Date.now(), name: e.split('@')[0], email: e, subscriptionActive: false, weeklyDeductions: [], goals: [], budgets: {}, transactions: [] };
          setParticipants(prev => [...prev, user]);
        }
        // demo password check (not secure)
        if (user.demoPassword && pw && pw !== user.demoPassword) return notify('Incorrect password');
        setCurrentEmail(user.email);
        setPassword('');
        notify('Logged in as '+user.name);
      }

      function logout(){ setCurrentEmail(''); setPassword(''); }

      function setDemoPassword(pw){
        setParticipants(prev => prev.map(u => u.email===currentUser.email ? {...u, demoPassword: pw || undefined} : u));
        notify('Password updated (demo only)');
      }

      // Admin ops
      function adminAdjust(userId, delta, memo){
        setParticipants(prev => prev.map(u => {
          if (u.id !== userId) return u;
          return {...u, transactions: [...(u.transactions||[]), { amount: Number(delta), memo: memo||null, ts: now() }] };
        }));
      }
      function adminSub(userId){ setParticipants(prev => prev.map(u => u.id===userId? {...u, subscriptionActive:true}:u)); }
      function adminCancel(userId){ setParticipants(prev => prev.map(u => u.id===userId? {...u, subscriptionActive:false}:u)); }
      function adminDelete(userId){ if(!confirm('Delete participant?')) return; setParticipants(prev => prev.filter(u => u.id!==userId)); if(currentUser?.id===userId) logout(); }

      function exportData(){
        const blob = new Blob([JSON.stringify(participants,null,2)], { type:'application/json' });
        const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='teenbank_data.json'; a.click(); URL.revokeObjectURL(url);
      }
      async function importData(file){
        if (!file) return; const text = await file.text();
        try{ const data = JSON.parse(text); if(!Array.isArray(data)) throw new Error('Bad JSON'); setParticipants(migrateIfNeeded(JSON.stringify(data))); notify('Import complete'); }
        catch(e){ alert('Import failed: '+e.message); }
      }

      function updateMe(mut){
        setParticipants(prev => prev.map(u => u.email===currentUser.email ? (typeof mut==='function'? mut(u):{...u, ...mut}) : u));
      }

      function applyMyWeeklyNow(){
        const me = currentUser; if(!me) return;
        setParticipants(prev => prev.map(u => {
          if (u.email !== me.email) return u;
          const txs = [...(u.transactions||[])];
          (u.weeklyDeductions||[]).forEach(d => txs.push({ amount: -Number(d.amount), memo: `Weekly: ${d.name}`, ts: now() }));
          return {...u, transactions: txs};
        }));
        notify('Applied weekly deductions');
      }

      // ---------- Screens ----------
      if (!currentUser){
        return (
          <div className="min-h-screen flex flex-col items-center justify-center p-6">
            <div className="bg-white dark:bg-slate-800 max-w-md w-full rounded-2xl shadow p-6">
              <div className="flex items-center justify-between mb-3">
                <h1 className="text-2xl font-bold">TeenBank Login</h1>
                <button className="text-xs px-2 py-1 rounded border dark:border-slate-700" onClick={()=>setTheme(t=>t==='dark'?'light':'dark')}>{theme==='dark'?'Light':'Dark'}</button>
              </div>
              <p className="text-sm text-slate-600 dark:text-slate-300 mb-4">Enter your email to simulate Gmail login. Demo-only; data stored in your browser.</p>
              <label className="text-sm block mb-1">Email</label>
              <input type="email" className="border w-full p-2 rounded mb-3 dark:bg-slate-900 dark:border-slate-700" placeholder="you@gmail.com" value={currentEmail} onChange={e=>setCurrentEmail(e.target.value)} />
              <label className="text-sm block mb-1">Password (if previously set)</label>
              <input type="password" className="border w-full p-2 rounded mb-4 dark:bg-slate-900 dark:border-slate-700" placeholder="••••••••" value={password} onChange={e=>setPassword(e.target.value)} />
              <button className="w-full bg-indigo-600 text-white py-2 rounded" onClick={()=>login(currentEmail, password)}>Login</button>
              <div className="mt-6 flex items-center justify-between text-xs text-slate-500">
                <button className="underline" onClick={()=>{ localStorage.removeItem(DB_KEY); location.reload(); }}>Reset demo</button>
                <div className="flex items-center gap-2">
                  <button className="underline" onClick={exportData}>Export</button>
                  <label className="underline cursor-pointer">
                    Import
                    <input type="file" accept="application/json" className="hidden" onChange={e=>importData(e.target.files[0])} />
                  </label>
                </div>
              </div>
              <p className="mt-3 text-xs text-slate-500">Tip: Log in with <span className="font-mono">{ADMIN_EMAIL}</span> for the admin view.</p>
            </div>
          </div>
        );
      }

      // Dashboard
      return (
        <div className="min-h-screen p-6">
          <header className="max-w-5xl mx-auto mb-6 flex items-center justify-between">
            <div>
              <h1 className="text-2xl font-bold">TeenBank Dashboard</h1>
              <div className="text-sm text-slate-600 dark:text-slate-300">Logged in as <strong>{currentUser.name}</strong> {isAdmin && <span className="ml-1">(Admin)</span>}</div>
            </div>
            <div className="flex items-center gap-2">
              <button className="px-3 py-2 text-sm rounded border dark:border-slate-700" onClick={()=>setTheme(t=>t==='dark'?'light':'dark')}>{theme==='dark'?'Light':'Dark'}</button>
              <button className="px-3 py-2 text-sm rounded bg-slate-200 dark:bg-slate-700" onClick={exportData}>Export</button>
              <label className="px-3 py-2 text-sm rounded bg-slate-200 dark:bg-slate-700 cursor-pointer">Import<input type="file" accept="application/json" className="hidden" onChange={e=>importData(e.target.files[0])} /></label>
              <button className="px-3 py-2 text-sm rounded bg-slate-800 text-white" onClick={()=>{ setCurrentEmail(''); setPassword(''); }}>Logout</button>
            </div>
          </header>

          <main className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
            {isAdmin ? (
              <AdminPanel
                participants={participants}
                onAdjust={adminAdjust}
                onSubscribe={adminSub}
                onCancel={adminCancel}
                onDelete={adminDelete}
              />
            ) : (
              <UserPanel
                user={currentUser}
                updateUser={(mut)=> updateMe(mut) }
                applyWeeklyAll={applyMyWeeklyNow}
              />
            )}

            {/* Side panel */}
            <aside className="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm space-y-4">
              <h3 className="text-lg font-semibold">Participants</h3>
              <ul className="space-y-2 max-h-[420px] overflow-auto pr-1">
                {participants.map(p => (
                  <li key={p.id} className="flex items-center justify-between bg-slate-100 dark:bg-slate-900 p-2 rounded">
                    <div>
                      <div className="font-medium text-sm">{p.name}</div>
                      <div className="text-xs text-slate-500">{p.email}</div>
                    </div>
                    <div className="text-xs">{fmtUSD(computeBalance(p))}</div>
                  </li>
                ))}
              </ul>
              <div className="text-xs text-slate-500">Select a different user by logging out and entering their email.</div>
            </aside>
          </main>

          <footer className="max-w-5xl mx-auto mt-8 text-sm text-slate-500">
            Demo only. Real auth, multi-user persistence, and payment logic require a backend/API. Data stays in your browser.
          </footer>

          {toast && <Toast text={toast} onClose={()=>setToast(null)} />}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
